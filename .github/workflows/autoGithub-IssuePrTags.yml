name: "ü•á Auto Assign Labels - Bharat-Bhakti-Yatra"

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  label-assigner:
    runs-on: ubuntu-latest
    name: "Auto Assign Labels to New Issues & PRs"
    steps:
      - name: Assign Labels
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue || context.payload.pull_request;
            if (!issue) {
              console.log("‚ö† No issue or PR context found.");
              return;
            }

            const labelsToAdd = [];
            const title = (issue.title || "").toLowerCase();

            // --- Label rules ---
            if (title.includes("bug") || title.includes("error") || title.includes("fail")) {
              labelsToAdd.push("bug");
            }
            if (title.includes("feature") || title.includes("enhancement") || title.includes("add")) {
              labelsToAdd.push("enhancement");
            }
            if (title.includes("doc") || title.includes("readme") || title.includes("guide")) {
              labelsToAdd.push("documentation");
            }
            if (title.includes("fix") || title.includes("typo") || title.includes("small")) {
              labelsToAdd.push("Quick Fix");
            }
            if (title.includes("beginner") || title.includes("first") || title.includes("easy")) {
              labelsToAdd.push("good first issue");
            }
            if (title.includes("gsoc") || title.includes("gssoc25")) {
              labelsToAdd.push("gssoc25");
            }
            if (title.includes("collab") || title.includes("team") || title.includes("contributor")) {
              labelsToAdd.push("Team Player", "Consistent Contributor");
            }

            // Default label if no match
            if (!labelsToAdd.length) {
              labelsToAdd.push("help wanted");
            }

            // Add labels via REST API
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: labelsToAdd
            });

            console.log(`üè∑ Assigned labels: ${labelsToAdd.join(", ")} to #${issue.number}`);
