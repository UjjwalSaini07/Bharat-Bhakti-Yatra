name: 'ğŸŒ¸ Weekly Top Contributors - Bharat-Bhakti-Yatra'

on:
  schedule:
    - cron: '0 9 * * 1' # Every Monday at 9 AM UTC
  workflow_dispatch:

jobs:
  leaderboard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Post Weekly Top Contributors Issue
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // Fetch top 5 contributors
            const contributorsResp = await github.rest.repos.listContributors({ owner, repo, per_page: 5 });
            const contributors = contributorsResp.data;
            if (!contributors || contributors.length === 0) {
              console.log("No contributors found this week.");
              return;
            }

            // Generate leaderboard with medals and personalized comments
            const topContributors = contributors.map((c, index) => {
              let medal, comment;
              switch(index){
                case 0:
                  medal = "ğŸ¥‡"; comment = "Outstanding contribution! ğŸŒŸ";
                  break;
                case 1:
                  medal = "ğŸ¥ˆ"; comment = "Excellent work! âœ¨";
                  break;
                case 2:
                  medal = "ğŸ¥‰"; comment = "Great effort! ğŸ™";
                  break;
                default:
                  medal = "ğŸŒŸ"; comment = "Thank you for your contribution! ğŸ’–";
              }
              return `${medal} @${c.login} â€” **${c.contributions} contributions** â€” _${comment}_`;
            }).join("\n");

            // Build professional, engaging issue body
            const body = [
              "ğŸŒ¸ **Bharat-Bhakti-Yatra: Weekly Top Contributors** ğŸŒ¸",
              "",
              "A huge **thank you** to our amazing contributors who keep this spiritual journey of unity and devotion alive! ğŸ™",
              "",
              topContributors,
              "",
              "ğŸ’¡ **Weekly Summary:**",
              "- Total PRs merged:  " + contributors.reduce((sum, c) => sum + c.contributions, 0),
              "- Issues resolved:  TBD", // optional: you can fetch issues count if needed
              "- Notable contributions: bug fixes, documentation improvements, and community engagement ğŸŒ±",
              "",
              "ğŸ‰ **Shoutouts:**",
              "- Special thanks to contributors who went above and beyond this week ğŸš€",
              "- Every contribution, big or small, adds to our vibrant community ğŸŒº",
              "",
              "ğŸŒŸ **Next Steps & Opportunities:**",
              "- Explore issues labeled `good first issue` or `help wanted` to start contributing",
              "- Join discussions and share your thoughts on improving our project",
              "- Help review PRs or provide feedback to support fellow contributors",
              "",
              "ğŸ’– **Community & Resources:**",
              "- [Contributing Guidelines](https://github.com/UjjwalSaini07/Bharat-Bhakti-Yatra/blob/main/CONTRIBUTING.md)",
              "- [Project Documentation](https://github.com/UjjwalSaini07/Bharat-Bhakti-Yatra)",
              "- Stay connected with us on GitHub Discussions and share your ideas âœ¨",
              "",
              "ğŸŒº Together, let's celebrate unity, collaboration, and devotion. Keep shining and inspiring! ğŸ™"
            ].join("\n");

            // Create the issue
            const issue = await github.rest.issues.create({
              owner,
              repo,
              title: "ğŸ† Weekly Top Contributors",
              body,
              labels: ["leaderboard"]
            });

            console.log(`âœ… Top Contributors issue created successfully: ${issue.data.html_url}`);
