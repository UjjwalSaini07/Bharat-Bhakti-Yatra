name: "üå∫ Auto Celebrate PR Merge - Bharat-Bhakti-Yatra"

on:
  pull_request_target:
    types: [closed]

permissions:
  issues: write
  pull-requests: write

jobs:
  celebrate-merge:
    if: ${{ github.event.pull_request.merged == true }}
    runs-on: ubuntu-latest

    steps:
      - name: Post Spiritual Merge Celebration
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_USER: ${{ github.event.pull_request.user.login }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          REPO: ${{ github.repository }}
          COMMENT_BODY: |
            üåü **Namaste @${{ github.event.pull_request.user.login }}!** üôè  

            üéâ Your pull request **#${{ github.event.pull_request.number }} ‚Äî "${{ github.event.pull_request.title }}"** has been **successfully merged** into **Bharat-Bhakti-Yatra!** ü•≥‚ú®  

            üåº **Congratulations, and thank you for your divine contribution!**  
            Your effort adds another luminous step in our collective spiritual journey ‚Äî one that unites **hearts, faiths, and cultures** through the universal message of *devotion and togetherness.*  

            üå∫ **What Your Contribution Represents:**  
            Each line of code you write, each idea you share, becomes part of a digital pilgrimage ‚Äî where **Hindu, Muslim, Sikh, Jain, Buddhist, Christian, and countless other communities** walk together in harmony.  
            This is not just development ‚Äî it‚Äôs *digital dharma*, a celebration of India‚Äôs timeless unity in diversity. üáÆüá≥  

            üîπ **What‚Äôs Next:**  
            - üí° Continue sharing your ideas, creativity, and vision for this divine platform.  
            - üå± Help refine and expand Bharat-Bhakti-Yatra by contributing new features or improving existing ones.  
            - üí¨ Engage with fellow contributors ‚Äî inspire and guide them as we grow this sacred community.  
            - üå∏ Take a moment to reflect ‚Äî you‚Äôve helped shape something truly meaningful and lasting.  

            üïäÔ∏è **A Message from the Core Team:**  
            Your contribution strengthens the foundation of Bharat-Bhakti-Yatra ‚Äî a space where *faith meets technology*, and devotion finds expression in code.  
            Together, we are building not just a project, but a *legacy of spiritual connectivity* for generations to come.  

            üöÄ **Thank You for Being a Beacon of Light and Collaboration.**  
            May your passion, positivity, and creativity continue to illuminate this path of unity and service.  

            ‚ú® *With deepest gratitude and divine blessings ‚Äî Jai Bharat! Jai Bhakti!* üáÆüá≥  
            üåà *Keep shining, and may your code continue to inspire others on this sacred journey.* üôè

        run: |
          echo "Posting celebration comment for PR #$PR_NUMBER by $PR_USER"

          # Build JSON payload safely (prefer jq, otherwise use python)
          if command -v jq >/dev/null 2>&1; then
            PAYLOAD=$(jq -n --arg body "$COMMENT_BODY" '{body: $body}')
          else
            PAYLOAD=$(printf '%s' "$COMMENT_BODY" | python3 -c 'import sys,json; print(json.dumps({"body": sys.stdin.read()}))')
          fi

          RESPONSE=$(curl -s -o response.json -w "%{http_code}" \
            -X POST \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/$REPO/issues/$PR_NUMBER/comments" \
            -d "$PAYLOAD")

          cat response.json
          if [ "$RESPONSE" -ne 201 ]; then
            echo "‚ùå Failed to post merge celebration comment (HTTP $RESPONSE)"
            exit 1
          fi
          echo "‚úÖ Merge celebration comment posted successfully"
