name: 'ğŸŒ¸ Top Contributors Recognition - Bharat-Bhakti-Yatra'

on:
  schedule:
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  leaderboard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Post Top Contributors Issue
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // Fetch top 5 contributors
            const contributorsResp = await github.rest.repos.listContributors({ owner, repo, per_page: 5 });
            const contributors = contributorsResp.data;
            if (!contributors || contributors.length === 0) {
              console.log("No contributors found this week.");
              return;
            }

            const topContributors = contributors.map((c, index) => {
              let medal = index === 0 ? "ğŸ¥‡" :
                          index === 1 ? "ğŸ¥ˆ" :
                          index === 2 ? "ğŸ¥‰" : "ğŸŒŸ";
              return `${medal} @${c.login} â€” **${c.contributions} contributions**`;
            }).join("\n");

            const body = [
              "ğŸŒ¸ **Bharat-Bhakti-Yatra: Top Contributors of the Week** ğŸŒ¸",
              "",
              "Let's celebrate our amazing contributors who help make this spiritual journey of unity and devotion shine! ğŸ™",
              "",
              topContributors,
              "",
              "ğŸ’– Your dedication strengthens the project and inspires the community.",
              "",
              "âœ¨ **Keep contributing and spreading positivity!** Every effort counts in this sacred journey.",
              "",
              "_New contributors are always welcome! Explore issues labeled `good first issue` or `help wanted` to get started._ ğŸŒº"
            ].join("\n");

            // Create issue instead of discussion
            await github.rest.issues.create({
              owner,
              repo,
              title: "ğŸ† Top Contributors of the Week",
              body
            });

            console.log("âœ… Top contributors recognition issue created successfully.");
